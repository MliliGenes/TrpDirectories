<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../imgs/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../../style/main.css">
    
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/darcula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/default.min.css">
    
    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/shell/shell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
    
    <title>#pragma once vs Header Guards: Complete Guide - Learning Guide</title>
</head>
<body>
        <header>
        <div class="container">
            <div class="header-content">
                <div class="header-title">
                    <h1>#pragma once vs Header Guards: Complete Guide</h1>
                    <div class="author-info">By sel-mlil</div>
                </div>
                <div class="header-nav">
                    <a href="../../" class="back-to-index">
                        Back to Index
                    </a>
                    <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
                </div>
            </div>
        </div>
    </header>
        <nav>
        <div class="container">
            <div class="guide-nav-grid">
                <a class="guide-nav-item" href="#hook" data-section="0">üéØ The Hook</a>
                <a class="guide-nav-item" href="#mechanics" data-section="1">‚öôÔ∏è How It Works</a>
                <a class="guide-nav-item" href="#examples" data-section="2">üåç Real Examples</a>
                <a class="guide-nav-item" href="#practice" data-section="3">üõ†Ô∏è Do This Now</a>
                <a class="guide-nav-item" href="#warnings" data-section="4">‚ö†Ô∏è Avoid These</a>
                <a class="guide-nav-item" href="#connections" data-section="5">üîó Connections</a>
                <a class="guide-nav-item" href="#test" data-section="6">üéØ Test Yourself</a>
                <a class="guide-nav-item" href="#growth" data-section="7">üìà Level Up</a>
            </div>
        </div>
    </nav>
        <main class="container">
        <section id="hook">
            <div class="section-header">
                <div class="section-icon hook">üéØ</div>
                <h2 class="section-title">THE HOOK</h2>
            </div>
            <div class="content">
                <p><strong>What is this?</strong><br>Both prevent <strong>multiple inclusion</strong> - stopping the same header from being processed twice during compilation, which causes "redefinition" errors.</p>
                <ul>
                    <li><strong>#pragma once:</strong> Compiler directive that marks the file itself</li>
                    <li><strong>Header guards:</strong> Preprocessor macro-based inclusion check</li>
                    <li><strong>Why both?:</strong> Compatibility + optimization</li>
                </ul>
                <p><strong>Why care?</strong></p>
                <ul>
                    <li>Missing either = compilation errors on any non-trivial project</li>
                    <li>#pragma once is faster (5-10% compile time improvement on large codebases)</li>
                    <li>Header guards are 100% portable, #pragma once is 99.9% portable</li>
                </ul>
                <p><strong>Mental model:</strong><br>Header guards are a doorman checking IDs against a list. #pragma once is a "no re-entry" stamp on your hand - faster, but some venues don't recognize it.</p>
            </div>
        </section>

        <section id="mechanics">
            <div class="section-header">
                <div class="section-icon mechanics">‚öôÔ∏è</div>
                <h2 class="section-title">HOW IT WORKS</h2>
            </div>
            <div class="content">
                <h3>Header Guards Mechanics</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-yzfbulegd" class="codemirror-code">#ifndef UNIQUE_IDENTIFIER_H
#define UNIQUE_IDENTIFIER_H

// Header content

#endif // UNIQUE_IDENTIFIER_H</textarea>
                </div>
                <ol>
                    <li>First inclusion: <code>UNIQUE_IDENTIFIER_H</code> undefined ‚Üí define it, process content</li>
                    <li>Second inclusion: <code>UNIQUE_IDENTIFIER_H</code> defined ‚Üí skip to <code>#endif</code></li>
                    <li>Preprocessor textually removes skipped content before compilation</li>
                </ol>
                <h3>#pragma once Mechanics</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-4tt47mi20" class="codemirror-code">#pragma once

// Header content</textarea>
                </div>
                <ol>
                    <li>Compiler records file's <strong>physical location</strong> (inode on Unix, file handle on Windows)</li>
                    <li>Subsequent inclusions of same physical file ‚Üí skipped entirely</li>
                    <li>No preprocessor token checking needed</li>
                </ol>
                <h3>Key Difference</h3>
                <ul>
                    <li><strong>Header guards:</strong> Content-based (checks macro symbol)</li>
                    <li><strong>#pragma once:</strong> File-based (checks file identity)</li>
                </ul>
            </div>
        </section>

        <section id="examples">
            <div class="section-header">
                <div class="section-icon examples">üåç</div>
                <h2 class="section-title">REAL EXAMPLES</h2>
            </div>
            <div class="content">
                <h3>Standard Header Guard</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-v0irutbhj" class="codemirror-code">// math_utils.h
#ifndef MATH_UTILS_H
#define MATH_UTILS_H

class Vector3 {
public:
    float x, y, z;
    Vector3(float x, float y, float z);
    float magnitude() const;
};

#endif // MATH_UTILS_H</textarea>
                </div>
                <h3>With #pragma once</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-340niso6e" class="codemirror-code">// math_utils.h
#pragma once

class Vector3 {
public:
    float x, y, z;
    Vector3(float x, float y, float z);
    float magnitude() const;
};</textarea>
                </div>
                <h3>Both Together (Recommended)</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-hwn31675g" class="codemirror-code">// math_utils.h
#pragma once
#ifndef MATH_UTILS_H
#define MATH_UTILS_H

class Vector3 {
public:
    float x, y, z;
    Vector3(float x, float y, float z);
    float magnitude() const;
};

#endif // MATH_UTILS_H</textarea>
                </div>
                <p><strong>Why both?</strong></p>
                <ul>
                    <li>#pragma once provides speed optimization on supported compilers (GCC, Clang, MSVC, ICC)</li>
                    <li>Header guards ensure portability to any C++ compiler</li>
                    <li>Negligible downsides, maximum compatibility</li>
                </ul>
            </div>
        </section>

        <section id="practice">
            <div class="section-header">
                <div class="section-icon practice">üõ†Ô∏è</div>
                <h2 class="section-title">DO THIS NOW</h2>
            </div>
            <div class="content">
                <h3>Setup</h3>
                <div class="code-block" data-language="bash">
                    <textarea id="code-p5mhy693z" class="codemirror-code"># Create test files
mkdir include
touch include/vector.h include/matrix.h include/main.cpp</textarea>
                </div>
                <h3>vector.h</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-gjb54hkjr" class="codemirror-code">#pragma once
#ifndef VECTOR_H
#define VECTOR_H

#include <iostream>

struct Vector2 {
    float x, y;
    void print() const {
        std::cout << "(" << x << ", " << y << ")\n";
    }
};

#endif</textarea>
                </div>
                <h3>matrix.h</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-valseswxu" class="codemirror-code">#pragma once
#ifndef MATRIX_H
#define MATRIX_H

#include "vector.h"  // Includes Vector2

struct Matrix2x2 {
    Vector2 row1, row2;
};

#endif</textarea>
                </div>
                <h3>main.cpp</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-jz6729zt9" class="codemirror-code">#include "vector.h"
#include "matrix.h"  // Will include vector.h again
#include "vector.h"  // Third inclusion

int main() {
    Vector2 v{1.0f, 2.0f};
    v.print();
    return 0;
}</textarea>
                </div>
                <h3>Compile</h3>
                <div class="code-block" data-language="bash">
                    <textarea id="code-tgjvjgq0u" class="codemirror-code">g++ -I include main.cpp -o test
./test
# Output: (1, 2)</textarea>
                </div>
                <div class="action-box">
                <p><strong>What to look for:</strong></p>
                <ul>
                    <li>No redefinition errors despite multiple inclusions</li>
                    <li>Single compilation (fast)</li>
                </ul>
                <p><strong>Test without guards:</strong><br>Remove both mechanisms from vector.h, recompile ‚Üí see redefinition errors.</p>
                </div>
            </div>
        </section>

        <section id="warnings">
            <div class="section-header">
                <div class="section-icon warnings">‚ö†Ô∏è</div>
                <h2 class="section-title">AVOID THESE</h2>
            </div>
            <div class="content">
                <div class="warning-box">
                <h3>1. Non-unique guard names</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-59fazelwm" class="codemirror-code">// BAD - generic name
#ifndef UTILS_H  // Collides with other "utils.h" files
#define UTILS_H</textarea>
                </div>
                <p><strong>Fix:</strong> Use project prefix: <code>PROJECT_MODULE_FILENAME_H</code></p>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-gaqz6a1ci" class="codemirror-code">#ifndef MYPROJECT_MATH_UTILS_H
#define MYPROJECT_MATH_UTILS_H</textarea>
                </div>
                <h3>2. Symlinks with #pragma once</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-p9q8csi4r" class="codemirror-code">// project/include/math.h (real file)
// project/math.h (symlink to include/math.h)</textarea>
                </div>
                <p>Including both paths may fail with #pragma once (different file paths, same content). Header guards prevent this.</p>
                <h3>3. Missing #endif</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-0vbyr5q1c" class="codemirror-code">#ifndef HEADER_H
#define HEADER_H
// content
// Forgot #endif - entire rest of file treated as part of guard!</textarea>
                </div>
                <h3>4. Typos in guard name</h3>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-ns2qkmndp" class="codemirror-code">#ifndef MATH_UTILS_H
#define MATH_UTLIS_H  // Typo! Guard never triggers</textarea>
                </div>
                </div>
            </div>
        </section>

        <section id="connections">
            <div class="section-header">
                <div class="section-icon connections">üîó</div>
                <h2 class="section-title">CONNECTIONS</h2>
            </div>
            <div class="content">
                <p><strong>Prerequisites:</strong></p>
                <ul>
                    <li>C preprocessor basics (#include, #define, #ifndef)</li>
                    <li>Compilation process (preprocessing ‚Üí compilation ‚Üí linking)</li>
                </ul>
                <p><strong>Related concepts:</strong></p>
                <ul>
                    <li><strong>Forward declarations:</strong> Reduce header dependencies</li>
                    <li><strong>Precompiled headers:</strong> Cache commonly included headers</li>
                    <li><strong>Modules (C++20):</strong> Modern replacement eliminating inclusion guards entirely</li>
                </ul>
                <h3>Modern evolution</h3>
                <p>C++20 modules make both obsolete:</p>
                <div class="code-block" data-language="cpp">
                    <textarea id="code-q5rjmdbu4" class="codemirror-code">// math.cppm (module file)
export module math;
export class Vector3 { /*...*/ };

// main.cpp
import math;  // No inclusion guards needed</textarea>
                </div>
            </div>
        </section>

        <section id="test">
            <div class="section-header">
                <div class="section-icon test">üéØ</div>
                <h2 class="section-title">TEST YOURSELF</h2>
            </div>
            <div class="content">
                <ol>
                    <li>What happens if two headers use the same guard macro name?</li>
                    <li>Why might #pragma once fail with symlinks?</li>
                    <li>Create a circular dependency scenario that guards prevent</li>
                    <li>When would you use only header guards (no #pragma once)?</li>
                    <li>Write a script to generate consistent guard names from filenames</li>
                </ol>
                <p><strong>Success criteria:</strong></p>
                <ul>
                    <li>All your headers have both mechanisms</li>
                    <li>Zero multiple definition errors in your projects</li>
                    <li>Understand when each mechanism triggers</li>
                </ul>
            </div>
        </section>

        <section id="growth">
            <div class="section-header">
                <div class="section-icon growth">üìà</div>
                <h2 class="section-title">LEVEL UP</h2>
            </div>
            <div class="content">
                <ul>
                    <li><strong>This week:</strong> Add both to all existing headers, create naming convention (e.g., PROJ_PATH_FILE_H), set up editor snippets for auto-insertion</li>
                    <li><strong>This month:</strong> Study C++20 modules as long-term replacement, profile compile times with/without #pragma once, implement precompiled headers for common includes</li>
                    <li><strong>Long term:</strong> Migrate projects to C++20 modules, contribute to build system optimization, understand compiler include path resolution deeply</li>
                </ul>
            </div>
        </section>
    </main>
        <footer>
        <div class="container">
            <p>Learning journey completed! üéâ</p>
            <div class="checkbox-item" style="justify-content: center; margin-top: 1rem;">
                <div class="checkbox" onclick="toggleComplete(this)"></div>
                <span>Mark this topic as mastered</span>
            </div>
        </div>
    </footer>
        <script>
        // Theme toggle
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update button text
            updateThemeButton(newTheme);
        }

        // Update theme button text based on current theme
        function updateThemeButton(currentTheme) {
            const button = document.querySelector('.theme-toggle');
            if (currentTheme === 'dark') {
                button.innerHTML = '‚òÄÔ∏è Light Mode';
            } else {
                button.innerHTML = 'üåô Dark Mode';
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
        }

        // Initialize theme on page load
        document.addEventListener('DOMContentLoaded', loadTheme);

        // Section completion
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                this.classList.toggle('completed');
                const completedSections = Array.from(document.querySelectorAll('.nav-item.completed'))
                    .map(el => el.getAttribute('data-section'));
                localStorage.setItem('completed--pragma-once-vs-header-guards--complete-guide', JSON.stringify(completedSections));
            });
        });

        // Load saved progress
        const savedProgress = localStorage.getItem('completed--pragma-once-vs-header-guards--complete-guide');
        if (savedProgress) {
            const completed = JSON.parse(savedProgress);
            completed.forEach(sectionNum => {
                const navItem = document.querySelector(`[data-section="${sectionNum}"]`);
                if (navItem) navItem.classList.add('completed');
            });
        }

        // Checkbox functionality
        function toggleComplete(checkbox) {
            checkbox.classList.toggle('checked');
            if (checkbox.classList.contains('checked')) {
                checkbox.innerHTML = '‚úì';
                localStorage.setItem('mastered--pragma-once-vs-header-guards--complete-guide', 'true');
            } else {
                checkbox.innerHTML = '';
                localStorage.setItem('mastered--pragma-once-vs-header-guards--complete-guide', 'false');
            }
        }

        // Load mastery status
        const masteryStatus = localStorage.getItem('mastered--pragma-once-vs-header-guards--complete-guide');
        if (masteryStatus === 'true') {
            const masteryCheckbox = document.querySelector('footer .checkbox');
            if (masteryCheckbox) {
                masteryCheckbox.classList.add('checked');
                masteryCheckbox.innerHTML = '‚úì';
            }
        }

        // Smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Initialize CodeMirror for all code blocks
        let initAttempts = 0;
        const maxAttempts = 50; // Max 5 seconds of retries
        
        function initializeCodeMirror() {
            initAttempts++;
            
            // Check if CodeMirror is loaded
            if (typeof CodeMirror === 'undefined') {
                if (initAttempts >= maxAttempts) {
                    console.error('Failed to load CodeMirror after', maxAttempts, 'attempts. Using fallback styling.');
                    // Fallback: Style textareas as basic code blocks
                    document.querySelectorAll('.codemirror-code').forEach(textarea => {
                        textarea.style.fontFamily = 'Monaco, Menlo, "Ubuntu Mono", monospace';
                        textarea.style.fontSize = '14px';
                        textarea.style.lineHeight = '1.5';
                        textarea.style.padding = '10px';
                        textarea.style.border = '1px solid var(--border)';
                        textarea.style.borderRadius = '4px';
                        textarea.style.background = 'var(--code-bg)';
                        textarea.style.color = 'var(--code-text)';
                        textarea.style.resize = 'none';
                        textarea.style.minHeight = '100px';
                        textarea.readOnly = true;
                    });
                    return;
                }
                console.warn('CodeMirror not loaded, retrying in 100ms... (attempt', initAttempts, '/', maxAttempts, ')');
                setTimeout(initializeCodeMirror, 100);
                return;
            }
            
            const codeTextareas = document.querySelectorAll('.codemirror-code');
            console.log('Initializing CodeMirror for', codeTextareas.length, 'code blocks');
            
            codeTextareas.forEach(textarea => {
                const codeBlock = textarea.closest('.code-block');
                const language = codeBlock.dataset.language;
                
                // Map language to CodeMirror mode
                let mode = 'text';
                switch(language) {
                    case 'c':
                    case 'cpp':
                    case 'c++':
                        mode = 'text/x-csrc';
                        break;
                    case 'javascript':
                    case 'js':
                        mode = 'javascript';
                        break;
                    case 'bash':
                    case 'shell':
                    case 'sh':
                        mode = 'shell';
                        break;
                    case 'css':
                        mode = 'css';
                        break;
                    case 'html':
                        mode = 'htmlmixed';
                        break;
                    case 'json':
                        mode = 'application/json';
                        break;
                    default:
                        mode = 'text';
                }
                
                // Use custom theme that respects CSS variables
                const cmTheme = 'default'; // We'll override with CSS
                
                try {
                    const editor = CodeMirror.fromTextArea(textarea, {
                        mode: mode,
                        theme: cmTheme,
                        lineNumbers: true,
                        readOnly: 'nocursor',  // Disable cursor and selection
                        lineWrapping: true,    // Enable line wrapping to avoid horizontal scroll
                        scrollbarStyle: 'null', // Remove scrollbars
                        viewportMargin: Infinity, // Show all content without scrolling
                        matchBrackets: false,  // Disable bracket matching highlights
                        styleActiveLine: false, // Disable active line highlighting
                        indentUnit: 4,
                        tabSize: 4
                    });
                    
                    // Store editor reference for theme switching
                    textarea.codeMirrorInstance = editor;
                    
                    // Auto-refresh editor size and ensure no scrollbars
                    setTimeout(() => {
                        editor.refresh();
                        editor.setSize(null, 'auto'); // Auto-height based on content
                    }, 100);
                    
                    console.log('CodeMirror initialized for language:', language, 'mode:', mode);
                } catch (error) {
                    console.error('Failed to initialize CodeMirror for textarea:', error);
                }
            });
        }
        
        // CodeMirror themes are handled by CSS variables, no need to update programmatically
        
        // Initialize CodeMirror when DOM and scripts are fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                // Wait a bit more for all scripts to load
                setTimeout(initializeCodeMirror, 200);
            });
        } else {
            // Document already loaded, wait for scripts
            setTimeout(initializeCodeMirror, 200);
        }
    </script>
</body>
</html>